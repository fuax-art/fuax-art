<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forever Unfinished - 3D Hub</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; font-family: 'Rajdhani', sans-serif; }
        
        /* THE HUD OVERLAY */
        #hud {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; /* Let clicks pass through to 3D scene */
            z-index: 10;
        }

        #title-overlay {
            position: absolute; top: 30px; width: 100%; text-align: center;
            color: #00fff7; text-transform: uppercase; letter-spacing: 5px;
            text-shadow: 0 0 20px rgba(0,255,247,0.6);
            transition: opacity 0.5s;
        }

        #instructions {
            position: absolute; bottom: 30px; width: 100%; text-align: center;
            color: #eaff00; font-size: 0.8em; letter-spacing: 2px;
            opacity: 0.7; animation: pulse 2s infinite;
        }

        /* CONTENT MODAL (Hidden by default) */
        #content-modal {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 80%; max-width: 600px;
            background: rgba(0, 0, 0, 0.85);
            border: 1px solid #00fff7;
            padding: 40px; border-radius: 4px;
            backdrop-filter: blur(10px);
            display: none; pointer-events: auto;
            color: #e0e0e0; text-align: center;
            box-shadow: 0 0 50px rgba(0, 255, 247, 0.2);
        }

        #content-modal h2 { color: #eaff00; text-transform: uppercase; letter-spacing: 3px; margin-bottom: 20px; }
        
        .modal-link {
            display: block; padding: 15px; margin: 10px 0;
            border: 1px solid #333; background: rgba(255,255,255,0.05);
            color: #00fff7; text-decoration: none; text-transform: uppercase;
            font-weight: bold; transition: 0.3s;
        }
        .modal-link:hover { background: #00fff7; color: black; box-shadow: 0 0 20px #00fff7; }

        /* RETURN BUTTON */
        #return-btn {
            position: absolute; top: 30px; left: 30px;
            color: #00fff7; border: 1px solid #00fff7;
            padding: 10px 25px; cursor: pointer;
            text-transform: uppercase; letter-spacing: 2px;
            background: rgba(0,0,0,0.8); pointer-events: auto;
            display: none;
        }
        #return-btn:hover { background: #00fff7; color: black; }

        @keyframes pulse { 0% { opacity: 0.4; } 50% { opacity: 1; } 100% { opacity: 0.4; } }
    </style>
</head>
<body>

    <div id="hud">
        <div id="title-overlay">
            <h1>Forever Unfinished</h1>
            <p style="font-size: 0.8em; color: #eaff00;">// Neural Link Established</p>
        </div>
        <div id="instructions">[ CLICK A CUBE TO INTERFACE ]</div>
        <div id="return-btn"><i class="fas fa-arrow-left"></i> Disengage</div>
    </div>

    <div id="content-modal">
        <h2 id="modal-title">TITLE</h2>
        <div id="modal-links"></div>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/",
                "@tweenjs/tween.js": "https://unpkg.com/@tweenjs/tween.js@23.1.1/dist/tween.esm.js"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';
        import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
        import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
        import { OutputPass } from 'three/addons/postprocessing/OutputPass.js';
        import TWEEN from '@tweenjs/tween.js';

        // --- 1. AUDIO SYSTEM ---
        const sfxHover = new Audio('assets/audio/hover.mp3');
        const sfxOpen = new Audio('assets/audio/open.mp3');
        const sfxClose = new Audio('assets/audio/close.mp3');
        sfxHover.volume = 0.2; sfxOpen.volume = 0.4; sfxClose.volume = 0.3;

        // --- 2. SCENE SETUP ---
        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0x000000, 0.03); // Distance fog

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 8; // Starting position

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.toneMapping = THREE.ReinhardToneMapping;
        document.body.appendChild(renderer.domElement);

        // --- 3. POST-PROCESSING (THE GLOW) ---
        const renderScene = new RenderPass(scene, camera);
        const bloomPass = new UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), 1.5, 0.4, 0.85);
        bloomPass.threshold = 0;
        bloomPass.strength = 1.2; // GLOW STRENGTH
        bloomPass.radius = 0.5;

        const composer = new EffectComposer(renderer);
        composer.addPass(renderScene);
        composer.addPass(bloomPass);
        const outputPass = new OutputPass();
        composer.addPass(outputPass);

        // --- 4. LIGHTING ---
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.1);
        scene.add(ambientLight);

        // Neon Blue Light
        const pLight1 = new THREE.PointLight(0x00fff7, 100, 50);
        pLight1.position.set(5, 5, 5);
        scene.add(pLight1);

        // Neon Yellow Light
        const pLight2 = new THREE.PointLight(0xeaff00, 100, 50);
        pLight2.position.set(-5, -5, 5);
        scene.add(pLight2);

        // --- 5. CREATE CUBES ---
        const cubes = [];
        // Data structure for our links
        const cubeData = [
            { id: 0, name: "Shop", pos: {x: -3, y: 1.5, z: 0}, links: [
                {text: "Main Shop", url: "https://foreverunfinishedartworx.square.site"},
                {text: "1980HD Pack", url: "https://foreverunfinishedartworx.square.site/product/1980hd-minimalist-pack/EH7ZR4VWQG2XV5RMAUB2MLD5"},
                {text: "Beautiful Chaos", url: "https://foreverunfinishedartworx.square.site/product/beautiful-chaos-framed-canvas/UHNET5PA4OKHZH3GQDPEZQ5H"}
            ]},
            { id: 1, name: "Music", pos: {x: 0, y: 1.5, z: 0}, links: [
                {text: "SoundCloud", url: "https://soundcloud.com/faux-fuax"},
                {text: "Lyrics", url: "pages/lyrics.html"}
            ]},
            { id: 2, name: "Logs", pos: {x: 3, y: 1.5, z: 0}, links: [
                {text: "Captain's Log", url: "https://www.blogger.com/profile/14617392804110616005"},
                {text: "Have Ya Herd", url: "https://fauxfuax.blogspot.com/2025/10/have-you-herd-about-mycurd.html"}
            ]},
            { id: 3, name: "NFTs", pos: {x: -3, y: -1.5, z: 0}, links: [
                {text: "CyberPugz Collection", url: "pages/cbrpgz.html"},
                {text: "Base 2026", url: "#"}
            ]},
            { id: 4, name: "About", pos: {x: 0, y: -1.5, z: 0}, links: [
                {text: "Read The Story", url: "pages/about.html"}
            ]},
            { id: 5, name: "Dev", pos: {x: 3, y: -1.5, z: 0}, links: [
                {text: "Peculiar Paradigm", url: "https://github.com/fuax-art/PerculiarPardigm"},
                {text: "RetroCamera", url: "https://retro-camera-rust.vercel.app"}
            ]}
        ];

        const boxGeo = new THREE.BoxGeometry(1.5, 1.5, 1.5);
        
        // The Glass Material
        const glassMat = new THREE.MeshPhysicalMaterial({
            color: 0x222222,
            metalness: 0.1,
            roughness: 0.05,
            transmission: 0.9, // Make it see-through
            thickness: 1.0,
            transparent: true,
            opacity: 0.8
        });

        // Wireframe Material (The Neon Edge)
        const wireMat = new THREE.LineBasicMaterial({ color: 0x00fff7 });

        cubeData.forEach(data => {
            // Create the glass cube
            const cube = new THREE.Mesh(boxGeo, glassMat);
            cube.position.set(data.pos.x, data.pos.y, data.pos.z);
            cube.userData = { id: data.id, name: data.name }; // Store data in the 3D object

            // Create the neon edges
            const edges = new THREE.EdgesGeometry(boxGeo);
            const line = new THREE.LineSegments(edges, wireMat);
            cube.add(line); // Attach lines to cube

            scene.add(cube);
            cubes.push(cube);
        });

        // --- 6. INTERACTION (RAYCASTER) ---
        const raycaster = new THREE.Raycaster();
        const pointer = new THREE.Vector2();
        let hoveredCube = null;
        let activeCube = null; // Are we zoomed in?

        function onPointerMove( event ) {
            pointer.x = ( event.clientX / window.innerWidth ) * 2 - 1;
            pointer.y = - ( event.clientY / window.innerHeight ) * 2 + 1;
        }

        function onClick(event) {
            if (hoveredCube && !activeCube) {
                engageSystem(hoveredCube);
            }
        }

        window.addEventListener( 'pointermove', onPointerMove );
        window.addEventListener( 'click', onClick );

        // --- 7. ANIMATION LOOPS ---
        
        // Hover Effect Logic
        function checkIntersections() {
            if (activeCube) return; // Don't hover if we are zoomed in

            raycaster.setFromCamera( pointer, camera );
            const intersects = raycaster.intersectObjects( cubes );

            if ( intersects.length > 0 ) {
                const object = intersects[0].object;
                
                if (hoveredCube !== object) {
                    // Mouse Enter
                    sfxHover.currentTime = 0; sfxHover.play().catch(()=>{});
                    document.body.style.cursor = 'pointer';
                    
                    // Tween Scale Up
                    new TWEEN.Tween(object.scale).to({x: 1.2, y: 1.2, z: 1.2}, 300).start();
                    // Change Edge Color to Yellow
                    object.children[0].material.color.setHex(0xeaff00);
                    
                    hoveredCube = object;
                    document.getElementById('instructions').innerText = `[ ACCESSING: ${object.userData.name.toUpperCase()} ]`;
                }
            } else {
                if (hoveredCube) {
                    // Mouse Leave
                    new TWEEN.Tween(hoveredCube.scale).to({x: 1, y: 1, z: 1}, 300).start();
                    hoveredCube.children[0].material.color.setHex(0x00fff7);
                    
                    hoveredCube = null;
                    document.body.style.cursor = 'default';
                    document.getElementById('instructions').innerText = `[ CLICK A CUBE TO INTERFACE ]`;
                }
            }
        }

        // --- 8. CAMERA MOVEMENTS (The "Game" Feel) ---

        function engageSystem(cube) {
            activeCube = cube;
            sfxOpen.play();

            // 1. Hide Title
            document.getElementById('title-overlay').style.opacity = '0';
            document.getElementById('instructions').style.display = 'none';

            // 2. Move Camera to Cube
            // Calculate a position slightly in front of the cube
            const targetPos = { x: cube.position.x, y: cube.position.y, z: cube.position.z + 2.5 };
            
            new TWEEN.Tween(camera.position)
                .to(targetPos, 1000)
                .easing(TWEEN.Easing.Cubic.Out)
                .onComplete(() => {
                    // 3. Show Modal content
                    showModal(cube.userData.id);
                    document.getElementById('return-btn').style.display = 'block';
                })
                .start();
            
            // Look at the cube while moving
            new TWEEN.Tween(camera.rotation)
                .to({x: 0, y: 0, z: 0}, 1000) // Rough approximation, better to use lookAt in loop
                .start();
        }

        function disengageSystem() {
            sfxClose.play();
            document.getElementById('content-modal').style.display = 'none';
            document.getElementById('return-btn').style.display = 'none';
            document.getElementById('title-overlay').style.opacity = '1';
            document.getElementById('instructions').style.display = 'block';

            // Reset Camera
            new TWEEN.Tween(camera.position)
                .to({x: 0, y: 0, z: 8}, 1200)
                .easing(TWEEN.Easing.Cubic.InOut)
                .onComplete(() => {
                    activeCube = null;
                })
                .start();
        }

        // --- 9. MODAL LOGIC ---
        function showModal(id) {
            const data = cubeData.find(d => d.id === id);
            const modal = document.getElementById('content-modal');
            const title = document.getElementById('modal-title');
            const linkBox = document.getElementById('modal-links');

            title.innerText = data.name;
            linkBox.innerHTML = ''; // Clear old links

            data.links.forEach(link => {
                const a = document.createElement('a');
                a.href = link.url;
                a.innerText = link.text;
                a.className = 'modal-link';
                // If it's an external link, open new tab
                if (link.url.startsWith('http')) a.target = "_blank";
                linkBox.appendChild(a);
            });

            modal.style.display = 'block';
        }

        // Wire up the return button
        document.getElementById('return-btn').addEventListener('click', disengageSystem);

        // --- 10. MAIN LOOP ---
        function animate(time) {
            requestAnimationFrame(animate);

            TWEEN.update(time);
            
            // Idle Rotation (Only if not zoomed in)
            if (!activeCube) {
                cubes.forEach((cube, i) => {
                    cube.rotation.x += 0.005;
                    cube.rotation.y += 0.005;
                });
                
                // Slight Camera drift for 3D feel
                camera.position.x += (pointer.x * 0.5 - camera.position.x) * 0.05;
                camera.position.y += (pointer.y * 0.5 - camera.position.y) * 0.05;
                camera.lookAt(0,0,0);
            }

            checkIntersections();
            composer.render();
        }

        animate();

        // Window Resize Handle
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            composer.setSize(window.innerWidth, window.innerHeight);
        });

    </script>
</body>
</html>
